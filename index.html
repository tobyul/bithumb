<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>빗썸 시세 AG Grid</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-grid.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-theme-alpine.css" />
  <style>
    body { background: #f5f5f5; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 20px; }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; margin-bottom: 20px; color: #333; }
    .refresh-btn {
      display: block;
      margin: 0 auto 20px auto;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .refresh-btn:hover { background: #0056b3; }
    #myGrid { height: 600px; width: 100%; }
    .loading { text-align: center; color: #666; margin: 20px 0; }
    .coin-name { font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🪙 빗썸 암호화폐 실시간 시세</h1>
    <button class="refresh-btn" onclick="loadCryptoData()">🔄 새로고침</button>
    <div id="loading" class="loading" style="display: none;">데이터 로딩 중...</div>
    <div id="myGrid" class="ag-theme-alpine"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
  <script>
    let gridApi;

    // 암호화폐 심볼과 한국어 이름 매핑
    const coinNames = {
      'BTC': '비트코인',
      'ETH': '이더리움',
      'XRP': '리플',
      'BCH': '비트코인캐시',
      'LTC': '라이트코인',
      'EOS': '이오스',
      'ETC': '이더리움클래식',
      'XLM': '스텔라루멘',
      'ADA': '에이다',
      'DOT': '폴카닷',
      'LINK': '체인링크',
      'TRX': '트론',
      'VET': '비체인',
      'THETA': '시타',
      'BNB': '바이낸스코인',
      'MATIC': '폴리곤',
      'SOL': '솔라나',
      'AVAX': '아발란체',
      'DOGE': '도지코인',
      'SHIB': '시바이누',
      'UNI': '유니스왑',
      'ATOM': '코스모스',
      'ALGO': '알고랜드',
      'ICP': '인터넷컴퓨터',
      'FIL': '파일코인',
      'AAVE': '에이브',
      'COMP': '컴파운드',
      'MKR': '메이커',
      'SUSHI': '스시스왑',
      'CRV': '커브',
      'BAT': '베이직어텐션토큰',
      'ZRX': '제로엑스',
      'MANA': '디센트럴랜드',
      'SAND': '샌드박스',
      'ENJ': '엔진코인',
      'CHZ': '칠리즈',
      'FLOW': '플로우',
      'KLAY': '클레이튼',
      'WEMIX': '위믹스',
      'QTUM': '퀀텀',
      'LSK': '리스크',
      'STEEM': '스팀',
      'STRAX': '스트라티스',
      'ARDR': '아더',
      'STORJ': '스토리지',
      'GRT': '더그래프',
      'BAL': '밸런서',
      'REN': '렌',
      'KNC': '카이버네트워크',
      'ZIL': '질리카',
      'WAVES': '웨이브',
      'ICX': '아이콘',
      'OMG': '오미세고',
      'ANKR': '앵커',
      'CTC': '크레딧코인',
      'SBD': '스팀달러',
      'POLA': '폴라리스쉐어',
      'TEMCO': '템코',
      'HIBS': '하이브',
      'SOLVE': '솔브케어',
      'HBAR': '헤데라해시그래프',
      'IOST': '아이오에스티',
      'AERGO': '아르고',
      'DAWN': '던프로토콜',
      'META': '메타디움',
      'TFUEL': '시타퓨엘',
      'ORBS': '오브스',
      'VALOR': '밸러토큰',
      'CON': '코넌토큰',
      'ANKR': '앵커',
      'BORA': '보라',
      'JST': '저스트',
      'CRO': '크로노스',
      'TON': '톤코인',
      'BLUR': '블러',
      'PEPE': '페페',
      'APT': '앱토스',
      'OP': '옵티미즘',
      'ARB': '아비트럼',
      'SUI': '수이',
      'WLD': '월드코인',
      'TIA': '셀레스티아',
      'STRK': '스타크넷',
      'PYTH': '피스네트워크',
      'JUP': '주피터',
      'W': '웜홀',
      'ENA': '에나',
      'REZ': '리질리언트',
      'ETHFI': '이더파이',
      'PENDLE': '펜들',
      'RUNE': '토르체인',
      'NEAR': '니어프로토콜',
      'FTM': '팬텀',
      'IMX': '이뮤터블엑스',
      'INJ': '인젝티브',
      'LUNC': '루나클래식',
      'USTC': '테라USD클래식',
      'LUNA': '루나',
      'APE': '에이프코인',
      'GALA': '갈라',
      'AXS': '액시인피니티',
      'GMT': '스테픈',
      'STEPN': '스테픈',
      'JASMY': '재스미',
      'KAVA': '카바',
      'ROSE': '오아시스',
      'CELO': '셀로',
      'MINA': '미나',
      '1INCH': '원인치',
      'AUDIO': '오디우스',
      'CTK': '써틱',
      'BAND': '밴드프로토콜',
      'ALPHA': '알파파이낸스',
      'MDX': '맨덱스',
      'WAXP': '왁스',
      'KARA': '카라스타',
      'SSX': '썸씽',
      'HUNT': '헌트',
      'PLA': '플레이댑',
      'LOOM': '룸네트워크',
      'BZRX': '비지엑스',
      'WIKEN': '위켄',
      'OBSR': '옵저버',
      'MILK': '밀크',
      'BIOT': '바이오패스포트',
      'DUBBZ': '더블즈',
      'FLOKI': '플로키',
      'BONK': '봉크',
      'MEME': '메메코인',
      'WIF': '도그위드햇',
      'POPCAT': '팝캣',
      'BRETT': '브렛',
      'NEIRO': '네이로',
      'GOAT': '고트',
      'PNUT': '피넛',
      'ACT': '액트',
      'EIGEN': '아이겐',
      'USUAL': '유주얼',
      'MOVE': '무브',
      'ME': '매직에덴',
      'VIRTUAL': '버추얼',
      'AI16Z': 'AI16Z',
      'GRIFFAIN': '그리페인',
      'VANA': '바나',
      'VELODROME': '벨로드롬',
      'HYPERLIQUID': '하이퍼리퀴드',
      'FARTCOIN': '파트코인'
    };

    // 코인명 가져오기 함수
    const getCoinName = (symbol) => {
      return coinNames[symbol] || symbol;
    };

    // 포맷팅 함수들
    const formatPrice = (value) => {
      if (!value || value === '0') return '0';
      return parseFloat(value).toLocaleString('ko-KR') + ' 원';
    };

    const formatVolume = (value) => {
      if (!value || value === '0') return '0';
      const num = parseFloat(value);
      if (num >= 1000000) return (num/1000000).toFixed(2) + 'M';
      if (num >= 1000) return (num/1000).toFixed(2) + 'K';
      return num.toFixed(4);
    };

    const formatRate = (value) => {
      if (!value || value === '0') return '0.00%';
      const rate = parseFloat(value);
      return (rate > 0 ? '+' : '') + rate.toFixed(2) + '%';
    };

    // 심볼과 코인명을 함께 표시하는 렌더러
    const symbolCellRenderer = (params) => {
      const symbol = params.value;
      const coinName = getCoinName(symbol);
      return `<div style="font-weight: bold;">${symbol}</div><div class="coin-name">${coinName}</div>`;
    };

    // AG Grid 옵션
    const gridOptions = {
      columnDefs: [
        { 
          field: 'symbol', 
          headerName: '암호화폐', 
          width: 140, 
          pinned: 'left',
          cellRenderer: symbolCellRenderer,
          cellStyle: { padding: '8px' }
        },
        { 
          field: 'closing_price', 
          headerName: '현재가', 
          width: 120, 
          valueFormatter: params => formatPrice(params.value), 
          cellStyle: { fontWeight: 'bold', color: '#007bff' }
        },
        { 
          field: 'fluctate_rate_24H', 
          headerName: '24H 변동률', 
          width: 120, 
          valueFormatter: params => formatRate(params.value),
          cellStyle: params => ({
            color: parseFloat(params.value) > 0 ? '#dc3545' : parseFloat(params.value) < 0 ? '#007bff' : '#333',
            fontWeight: 'bold'
          })
        },
        { 
          field: 'opening_price', 
          headerName: '시가', 
          width: 120, 
          valueFormatter: params => formatPrice(params.value) 
        },
        { 
          field: 'min_price', 
          headerName: '최저가', 
          width: 120, 
          valueFormatter: params => formatPrice(params.value), 
          cellStyle: { color: '#dc3545' } 
        },
        { 
          field: 'max_price', 
          headerName: '최고가', 
          width: 120, 
          valueFormatter: params => formatPrice(params.value), 
          cellStyle: { color: '#28a745' } 
        },
        { 
          field: 'units_traded', 
          headerName: '거래량', 
          width: 120, 
          valueFormatter: params => formatVolume(params.value) 
        },
        { 
          field: 'acc_trade_value', 
          headerName: '거래대금', 
          width: 140, 
          valueFormatter: params => formatPrice(params.value) 
        }
      ],
      defaultColDef: {
        sortable: true,
        filter: true,
        resizable: true,
        minWidth: 100
      },
      rowData: [],
      rowHeight: 60, // 행 높이 증가로 심볼과 코인명 모두 표시
      onGridReady: function(params) {
        gridApi = params.api;
        loadCryptoData();
      }
    };

    // 데이터 로드 함수
    async function loadCryptoData() {
      const loadingDiv = document.getElementById('loading');
      loadingDiv.style.display = 'block';

      try {
        // 실제 빗썸 API 호출
        const response = await fetch('https://api.bithumb.com/public/ticker/ALL_KRW');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.status !== '0000') {
          throw new Error('API 응답 오류: ' + data.message);
        }

        // 데이터 변환
        const cryptoData = Object.keys(data.data)
          .filter(symbol => symbol !== 'date')
          .map(symbol => ({
            symbol,
            coinName: getCoinName(symbol),
            ...data.data[symbol]
          }))
          .sort((a, b) => parseFloat(b.closing_price) - parseFloat(a.closing_price));

        // AG Grid에 데이터 설정
        gridApi.setGridOption('rowData', cryptoData);
        
        console.log(`${cryptoData.length}개의 암호화폐 데이터가 로드되었습니다.`);

      } catch (error) {
        console.error('데이터 로드 오류:', error);
        
        // CORS 오류 시 샘플 데이터 사용
        const sampleData = [
          {
            symbol: 'BTC',
            coinName: '비트코인',
            opening_price: '158770000',
            closing_price: '159708000',
            min_price: '156800000',
            max_price: '159939000',
            units_traded: '645.38767361',
            acc_trade_value: '103071234567',
            fluctate_rate_24H: '0.54'
          },
          {
            symbol: 'ETH',
            coinName: '이더리움',
            opening_price: '4027000',
            closing_price: '4027000',
            min_price: '3900000',
            max_price: '4041000',
            units_traded: '17875.525049',
            acc_trade_value: '71982345678',
            fluctate_rate_24H: '-0.84'
          },
          {
            symbol: 'XRP',
            coinName: '리플',
            opening_price: '730',
            closing_price: '735',
            min_price: '720',
            max_price: '740',
            units_traded: '125674.123456',
            acc_trade_value: '92345678',
            fluctate_rate_24H: '0.96'
          },
          {
            symbol: 'ADA',
            coinName: '에이다',
            opening_price: '450',
            closing_price: '455',
            min_price: '445',
            max_price: '460',
            units_traded: '89234.567890',
            acc_trade_value: '40567890',
            fluctate_rate_24H: '1.56'
          },
          {
            symbol: 'DOT',
            coinName: '폴카닷',
            opening_price: '8500',
            closing_price: '8450',
            min_price: '8400',
            max_price: '8550',
            units_traded: '12345.678901',
            acc_trade_value: '104567890',
            fluctate_rate_24H: '-0.82'
          }
        ];
        
        gridApi.setGridOption('rowData', sampleData);
        console.log('샘플 데이터를 사용합니다.');
      } finally {
        loadingDiv.style.display = 'none';
      }
    }

    // 페이지 로드 시 AG Grid 초기화
    document.addEventListener('DOMContentLoaded', function() {
      const gridDiv = document.getElementById('myGrid');
      agGrid.createGrid(gridDiv, gridOptions);
    });
  </script>
</body>
</html>